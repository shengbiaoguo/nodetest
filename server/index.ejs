<!DOCTYPE html>
<html>
<head >
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" media="all" href="/style.min.css" />

    <% if (temp) {%>
        <%- temp %>
    <%}%>

    <base href="/">
</head>
<body>
    <div id="content"></div>
<script src="/main.min.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
    //ios回调
    window.shareCallback = function(b) {
      shareCallback2(b);
    }

    window.onload = function(){
        var weixin_base_url = encodeURIComponent(window.location.href.split('#')[0]);

        var sdata = {
                title: '<%= title %>',
                desc: '<%= desc %>',
                link: decodeURIComponent(weixin_base_url),
                imgUrl: 'https://campaign.2ccm.net/img/logo_2ccm.jpg',
        };

        Init(sdata);

        function Init(sdata){
            // wechat sdk 签名
            fetch('https://campaign.2ccm.net' + '/rsx/0', {
                method: "POST",
                mode: "cors",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: "url=" + weixin_base_url
            })
            .then(function(response){
                if(response.ok){
                    return response.json();
                } else {
                    Promise.reject({
                        status: response.status,
                        statusText: response.statusText
                    })
                }
            })
            .then(function(res){
                if(res.appid){
                    wx.config({
                        appId: res.appid,
                        debug: false,
                        timestamp: res.timestamp,
                        nonceStr: res.nonceStr,
                        signature: res.signature,
                        jsApiList: [
                            "checkJsApi",
                            "onMenuShareTimeline",
                            "onMenuShareAppMessage",
                            "onMenuShareQQ",
                            "onMenuShareWeibo",
                            "onMenuShareQZone",
                        ]
                    });

                    // 调用微信API
                    wx.ready(function(){
                        wx.onMenuShareTimeline(sdata);
                        wx.onMenuShareAppMessage(sdata);
                        wx.onMenuShareQQ(sdata);
                        wx.onMenuShareWeibo(sdata);
                        wx.onMenuShareQZone(sdata);

                        wx.error(function (res) {
                            console.log(res.errMsg);
                        });

                    });
                }
            })
            .catch(function(error){
                console.log(error,'------')
            })
        }
    }
</script>
</html>
